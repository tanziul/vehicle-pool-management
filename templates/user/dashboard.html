﻿{% extends "base.html" %}
{% load static %}

{% block page_title %}Available Vehicles{% endblock %}

{% block content %}
<div class="page-wrapper">
    {% if messages %}
        <div class="container-fluid mb-4">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="content-card p-4">
        <!-- Count Header -->
        <div class="text-center mb-4">
            <h4 class="text-primary fw-bold">
                {{ vehicles|length }} Vehicle{{ vehicles|length|pluralize }} Available
            </h4>
        </div>

        <!-- Grid — Now exactly 5 cards per row on large screens -->
        <div class="row g-3 justify-content-center">
            {% for v in vehicles %}
            <div class="col-5-per-row">
                <div class="vehicle-card-small">
                    <!-- Image -->
                    <div class="vehicle-image-container-small">
                        {% if v.photo %}
                            <img src="{{ v.photo.url }}" alt="{{ v.model }}" class="vehicle-image-small">
                        {% else %}
                            <i class="bi bi-truck vehicle-placeholder-small"></i>
                        {% endif %}
                    </div>

                    <!-- Body -->
                    <div class="vehicle-card-body-small">
                        <h6 class="vehicle-model-title">{{ v.model }}</h6>

                        <div class="vehicle-info-small">
                            <div class="info-row-small">
                                <i class="bi bi-tag-fill info-icon-small text-primary"></i>
                                <span class="info-label-small">Plate:</span>
                                <span class="info-value-small fw-bold">{{ v.vehicle_number }}</span>
                            </div>
                            <div class="info-row-small">
                                <i class="bi bi-people-fill info-icon-small text-success"></i>
                                <span class="info-label-small">Seats:</span>
                                <span class="info-value-small">{{ v.capacity }}</span>
                            </div>
                            <div class="info-row-small">
                                <i class="bi bi-person-fill info-icon-small text-info"></i>
                                <span class="info-label-small">Driver:</span>
                                <span class="info-value-small">
                                    {% if v.assigned_driver %}
                                        <strong class="text-success">{{ v.assigned_driver.name }}</strong>
                                    {% else %}
                                        <em class="text-muted">None</em>
                                    {% endif %}
                                </span>
                            </div>
                        </div>

                        <div class="text-center">
                            <span class="status-badge-small status-{{ v.status|lower }}-small">
                                {{ v.get_status_display }}
                            </span>
                        </div>

                        <button class="btn btn-request-small w-100 mt-2" data-bs-toggle="modal" data-bs-target="#requestModal{{ v.id }}">
                            <i class="bi bi-calendar-plus"></i> Request Trip
                        </button>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <i class="bi bi-truck display-4 text-muted mb-4"></i>
                <h5 class="text-muted fw-bold">No vehicles available</h5>
                <p class="text-muted">Please check back later.</p>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Modals -->
    {% for v in vehicles %}
    <div class="modal fade" id="requestModal{{ v.id }}" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <form method="post" action="{% url 'request_vehicle' v.id %}">
                {% csrf_token %}
                <div class="modal-content border-0 shadow">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title"><i class="bi bi-car-front me-2"></i>Request: {{ v.model }}</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Start Time *</label>
                                <input type="datetime-local" name="start_time" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">End Time *</label>
                                <input type="datetime-local" name="end_time" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Destination *</label>
                                <input type="text" name="destination" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-semibold">Purpose *</label>
                                <input type="text" name="purpose" class="form-control" required>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit Request</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}